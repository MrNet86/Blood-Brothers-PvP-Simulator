<!DOCTYPE html>
<html>
<head>
    <title>Blood Brothers Simulator</title>
    <meta name="description" content="A PvP Simulator for the Blood Brothers RPG game">
    <meta name="keywords" content="blood, brothers, simulator, PvP, RPG">
    <link href='http://fonts.googleapis.com/css?family=Alegreya+Sans:900' rel='stylesheet' type='text/css'>

    <script src="lib/svg.min.js"></script>
    <script src="lib/svg.filter.min.js"></script>
    <script src="compiled.js"></script>

    <style type="text/css">
        * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        .wrapper {
            display: table;
            table-layout: fixed;

            width:100%;
        }
        .wrapper div {
            display: table-cell;

        }
        .wrapper center {
            display: table-caption;
        }

        .svg {
            display: block;
            margin: 0 auto;
        }
        body{
          overflow:hidden; /* This will remove the default scroll, not really needed, safer nonetheless */
        }
        .leftSide {
            float: left; 
            width: 40%; 
            height: 100%; 
            overflow: auto;
            font-family: "Consolas";
            font-size: 12px;
        }
        #rightSide {
            padding-left: 20px;
            width:60%;
            height:100%; 
            float: left; 
            overflow: auto;
            overflow-x: hidden;
            font-family: "Consolas";
            font-size: 12px;
        }
        #svgWrapper {
            margin: 0 auto;
            width: 400px;
            height: 600px;
            background-image: url('img/bg01.png');
            background-size: 100%;
        }

        #startButton { /*from bootstrap*/
            margin: 0 auto;
            color: #ffffff;
            background-color: #5cb85c;
            border-color: #4cae4c;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            cursor: pointer;
            -webkit-user-select: none;
            background-image: none;
            border: 1px solid transparent;
            border-radius: 4px;
            -webkit-appearance: button;
            text-transform: none;
            display: none;
        }

    </style>

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-38672868-6', 'chinhodado.github.io');
        ga('send', 'pageview');
    </script>
</head>

<body>
    <div id="battleEventDiv" class="leftSide">
        <div style="display: none;" id="simDiv">
            Simulation: 100,000 battles
            <br>
            Simulation progress:
            <progress value="0" max="100000" id="progressBar" style="width: 300px;"></progress>
            <div id="simResultDiv">
            </div>
        </div>
    </div>

    <div id="rightSide">
        <div id="player2Fam" style="margin-bottom:30px;" class="wrapper">
            <center>Player 2</center>
            <div id="player2Fam0">
                <p>player2 fam 0 </p>         
            </div>
            <div id="player2Fam1">
                <p>player2 fam 1 </p>         
            </div>
            <div id="player2Fam2">
                <p>player2 fam 2 </p>         
            </div>
            <div id="player2Fam3">
                <p>player2 fam 3 </p>         
            </div>
            <div id="player2Fam4">
                <p>player2 fam 4 </p>         
            </div>
        </div>

        <div id="svgWrapper">
            <div id="svg"></div>
        </div>
        <button id="startButton">Start battle</button>
        <div id="player1Fam" style="margin-bottom:30px; margin-top: 30px; " class="wrapper">
            <center>Player 1</center>
            <div id="player1Fam0">
                <p>player1 fam 0 </p>         
            </div>
            <div id="player1Fam1">
                <p>player1 fam 1 </p>         
            </div>
            <div id="player1Fam2">
                <p>player1 fam 2 </p>         
            </div>
            <div id="player1Fam3">
                <p>player1 fam 3 </p>         
            </div>
            <div id="player1Fam4">
                <p>player1 fam 4 </p>         
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var data = {}, option = {};

        if (getURLParameter("r1")) {
            option.p1random = true;
        }

        if (getURLParameter("r2")) {
            option.p2random = true;
        }

        data.player1formation = getURLParameter("1f");
        data.player2formation = getURLParameter("2f");
        data.player1cardsInfo = [];
        data.player2cardsInfo = [];
        data.player1warlordSkillArray = [];
        data.player2warlordSkillArray = [];

        for (var i = 0; i < 5; i++) {
            data.player1cardsInfo.push(famDatabase[getURLParameter("f" + i)]);
            data.player2cardsInfo.push(famDatabase[getURLParameter("f" + (i + 10))]);
        }
        for (var i = 0; i < 3; i++) {
            data.player1warlordSkillArray.push(getURLParameter("s1" + i));
            data.player2warlordSkillArray.push(getURLParameter("s2" + i));
        }
        var worker = null;

        var mode = getURLParameter("mode");
        if (mode !== "sim") {
            if (!getURLParameter("debug")) {
                BattleGraphic.PLAY_MODE = 'AUTO';
                document.getElementById('battleEventDiv').style.display = 'none';
                document.getElementById('player2Fam').style.display = 'none';
                document.getElementById('player1Fam').style.display = 'none';
                document.getElementById('rightSide').style.width = '100%';
                document.getElementById('startButton').style.display = 'block';
                document.getElementById('startButton').onclick = function () {
                    BattleGraphic.getInstance().displayMajorEventAnimation(0);
                }
            }
            var newGame = new BattleModel(data, option);
            newGame.startBattle();
        }
        else if (mode == "sim") {
            // create a new game just to display the fam and formation
            var newGame = new BattleModel(data);

            // hide/show some elements on the page
            document.getElementById("simDiv").setAttribute("style", "display: block;");
            document.getElementById("player2Fam").innerHTML = "<center>Player 2</center>";
            document.getElementById("player1Fam").innerHTML = "<center>Player 1</center>";

            // now make the worker do the simulation in background
            worker = new Worker("worker.js");
            worker.onmessage = function (event) {
                if (event.data.status == "ongoing") {
                    document.getElementById("progressBar").setAttribute("value", event.data.progress);
                }
                else if (event.data.status == "done") {
                    document.getElementById("simResultDiv").innerHTML += ("Player 2 won: " + event.data.p2WinCount +
                        "<br> Player 1 won: " + event.data.p1WinCount + 
                        "<br><a href=setting.html>Go back to main page </a>");
                    worker.terminate();
                }
            };
            worker.postMessage(data);
        }
    </script>

</body>

</html>
